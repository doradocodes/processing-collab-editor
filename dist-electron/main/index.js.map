{"version":3,"file":"index.js","sources":["../../electron/main/index.js"],"sourcesContent":["import { app, BrowserWindow, shell, ipcMain } from 'electron'\nimport { createRequire } from 'node:module'\nimport { fileURLToPath } from 'node:url'\nimport path from 'node:path'\nimport os from 'node:os'\nimport fs from 'fs';\nimport { exec } from 'child_process';\n\nconst require = createRequire(import.meta.url)\nconst __dirname = path.dirname(fileURLToPath(import.meta.url))\n\n// The built directory structure\n//\n// ├─┬ dist-electron\n// │ ├─┬ main\n// │ │ └── index.js    > Electron-Main\n// │ └─┬ preload\n// │   └── index.mjs   > Preload-Scripts\n// ├─┬ dist\n// │ └── index.html    > Electron-Renderer\n//\nprocess.env.APP_ROOT = path.join(__dirname, '../..')\n\nexport const MAIN_DIST = path.join(process.env.APP_ROOT, 'dist-electron')\nexport const RENDERER_DIST = path.join(process.env.APP_ROOT, 'dist')\nexport const VITE_DEV_SERVER_URL = process.env.VITE_DEV_SERVER_URL\n\nprocess.env.VITE_PUBLIC = VITE_DEV_SERVER_URL\n  ? path.join(process.env.APP_ROOT, 'public')\n  : RENDERER_DIST\n\n// Disable GPU Acceleration for Windows 7\nif (os.release().startsWith('6.1')) app.disableHardwareAcceleration()\n\n// Set application name for Windows 10+ notifications\nif (process.platform === 'win32') app.setAppUserModelId(app.getName())\n\nif (!app.requestSingleInstanceLock()) {\n  app.quit()\n  process.exit(0)\n}\n\nlet win = null\nconst preload = path.join(__dirname, '../preload/index.mjs')\nconst indexHtml = path.join(RENDERER_DIST, 'index.html')\n\nasync function createWindow() {\n  win = new BrowserWindow({\n    title: 'Main window',\n    icon: path.join(process.env.VITE_PUBLIC, 'favicon.ico'),\n    webPreferences: {\n      preload,\n      // Warning: Enable nodeIntegration and disable contextIsolation is not secure in production\n      // nodeIntegration: true,\n\n      // Consider using contextBridge.exposeInMainWorld\n      // Read more on https://www.electronjs.org/docs/latest/tutorial/context-isolation\n      // contextIsolation: false,\n    },\n  })\n\n  if (VITE_DEV_SERVER_URL) { // #298\n    win.loadURL(VITE_DEV_SERVER_URL)\n    // Open devTool if the app is not packaged\n    win.webContents.openDevTools()\n  } else {\n    win.loadFile(indexHtml)\n  }\n\n  // Test actively push message to the Electron-Renderer\n  win.webContents.on('did-finish-load', () => {\n    win?.webContents.send('main-process-message', new Date().toLocaleString())\n  })\n\n  // Make all links open with the browser, not with the application\n  win.webContents.setWindowOpenHandler(({ url }) => {\n    if (url.startsWith('https:')) shell.openExternal(url)\n    return { action: 'deny' }\n  })\n}\n\n\nfunction createTempName() {\n  // const tempDir = os.tmpdir();\n  const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n  // const tempFilePath = path.join(tempDir, `tempfile-${uniqueSuffix}`);\n  return `tempfile-${uniqueSuffix}`;\n}\n\nfunction writeTempFile(content) {\n  const tempFileName = createTempName();\n  const folderPath = path.join(os.tmpdir(), 'processing-sketches', tempFileName);\n  const filePath = path.join(folderPath, `${tempFileName}.pde`);\n\n  return new Promise((resolve, reject) => {\n    fs.mkdir(folderPath, { recursive: true }, (err) => {\n      if (err) {\n        console.error(`Error creating folder: ${err.message}`);\n        reject(err);\n      }\n\n      console.log('Folder created successfully.');\n\n      // Write the file\n      fs.writeFile(filePath, content, (err) => {\n        if (err) {\n          console.error(`Error writing file: ${err.message}`);\n            reject(err);\n        }\n\n        console.log('File written successfully.');\n        resolve(folderPath)\n      });\n    });\n  });\n}\n\napp.whenReady().then(createWindow)\n\napp.on('window-all-closed', () => {\n  win = null\n  if (process.platform !== 'darwin') app.quit()\n})\n\napp.on('second-instance', () => {\n  if (win) {\n    // Focus on the main window if the user tried to open another\n    if (win.isMinimized()) win.restore()\n    win.focus()\n  }\n})\n\napp.on('activate', () => {\n  const allWindows = BrowserWindow.getAllWindows()\n  if (allWindows.length) {\n    allWindows[0].focus()\n  } else {\n    createWindow()\n  }\n})\n\n// New window example arg: new windows url\nipcMain.handle('open-win', (_, arg) => {\n  const childWindow = new BrowserWindow({\n    webPreferences: {\n      preload,\n      nodeIntegration: true,\n      contextIsolation: false,\n    },\n  })\n\n  if (VITE_DEV_SERVER_URL) {\n    childWindow.loadURL(`${VITE_DEV_SERVER_URL}#${arg}`)\n  } else {\n    childWindow.loadFile(indexHtml, { hash: arg })\n  }\n})\n\nipcMain.handle('run-processing', (event, content) => {\n  return new Promise(async (resolve, reject) => {\n    // const folderPath = await writeTempFile(content);\n\n    console.log('Running Processing sketch', '/Users/dorado/Development/pde-v2/sketch_240710b');\n    const process = exec(`processing-java --sketch=/Users/dorado/Development/pde-v2/sketch_240710b --run`);\n\n    process.stdout.on('data', (data) => {\n      console.log('data', data.toString());\n      event.sender.send('processing-output', data.toString());\n    });\n\n    process.stderr.on('data', (data) => {\n      console.log('error', data.toString());\n      event.sender.send('processing-output-err', data.toString());\n    });\n\n    process.on('close', (code) => {\n      resolve(`Process exited with code ${code}`);\n    });\n\n    process.on('error', (error) => {\n      console.log('error', error.message);\n      reject(`error: ${error.message}`);\n    });\n  });\n});\n\nipcMain.handle('write-temp-file', (event, content) => {\n  console.log('write-temp-file', content);\n  const filePath = writeTempFile(content);\n  console.log('write-temp-file', filePath);\n});\n"],"names":["err","process"],"mappings":"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"}